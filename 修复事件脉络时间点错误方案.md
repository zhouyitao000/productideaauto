# 解决事件脉络时间点错误问题计划

用户反馈热搜事件是最新的，但 LLM 生成的“事件脉络”时间点不对。这通常是因为 LLM 没有被明确告知“当前的准确日期”，导致它根据训练数据或模糊的搜索结果进行猜测。

## 根本原因
当前的 Prompt 虽然包含搜索结果，但没有明确告诉 LLM **今天的确切日期是 2026年1月20日**。LLM 可能会倾向于生成 2024 或 2025 年的时间线，或者如果搜索结果中只有“1月20日”而没有年份，LLM 可能会补全错误的年份。

## 解决方案

### 1. 强化 Prompt 中的时间上下文
在构建 Prompt 时，显式注入当前完整日期，并强制要求 LLM 以此为基准。

**修改前:**
```python
prompt = f"""
请分析以下微博热搜话题: "{topic['title']}".
...
"""
```

**修改后:**
```python
current_date_str = datetime.now().strftime("%Y年%m月%d日")
prompt = f"""
当前日期是: {current_date_str}。
请分析以下微博热搜话题: "{topic['title']}".
...
任务:
1. 总结事件脉络和关键细节（注意：请根据当前日期 {current_date_str} 准确推断事件发生的时间，确保年份正确）。
...
"""
```

### 2. 优化搜索查询 (Search Query)
虽然之前已经加上了年份，可以进一步强化。
*   当前: `f"{topic['title']} {datetime.now().year}年 最新消息"`
*   保持现状即可，这个改动是正确的。

### 3. 执行计划
1.  修改 `weibo_hotspot_analysis.py` 中的 `_process_single_topic` 方法。
2.  在 Prompt 开头添加 `当前日期是: YYYY年MM月DD日`。
3.  在任务说明中强调“确保年份正确，基于当前日期推断”。
4.  运行程序验证修复效果。